<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • plumber</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"><meta property="og:image" content="https://www.rplumber.io/logo.svg"></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">plumber</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="articles/quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="articles/routing-and-input.html">Routing &amp; Input</a></li>
    <li><a class="dropdown-item" href="articles/rendering-output.html">Rendering Output</a></li>
    <li><a class="dropdown-item" href="articles/execution-model.html">Runtime</a></li>
    <li><a class="dropdown-item" href="articles/security.html">Security</a></li>
    <li><a class="dropdown-item" href="articles/hosting.html">Hosting</a></li>
    <li><a class="dropdown-item" href="articles/programmatic-usage.html">Programmatic Usage</a></li>
    <li><a class="dropdown-item" href="articles/annotations.html">Annotations reference</a></li>
    <li><a class="dropdown-item" href="articles/tips-and-tricks.html">Tips &amp; Tricks</a></li>
    <li><a class="dropdown-item" href="articles/migration.html">Migration Guide</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://blog.rstudio.com/2021/03/29/plumber-v1-1-0/">Version 1.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/plumber/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.svg" class="logo" alt=""><h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstudio/plumber/blob/rc-v1.3.1/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="project-overview">Project Overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p>Plumber is an R package that enables creating web APIs by decorating R functions with roxygen2-style comments. It provides annotation-driven API definition (<code>#* @get /path</code>), automatic OpenAPI spec generation, and built-in Swagger UI.</p>
<p><strong>Current version:</strong> 1.3.0.9000 (development)</p>
</div>
<div class="section level2">
<h2 id="essential-commands">Essential Commands<a class="anchor" aria-label="anchor" href="#essential-commands"></a></h2>
<div class="section level3">
<h3 id="package-development">Package Development<a class="anchor" aria-label="anchor" href="#package-development"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install development version</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"rstudio/plumber"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load package for interactive development</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build and check package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate documentation from roxygen comments</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run all tests</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run specific test file</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_file.html" class="external-link">test_file</a></span><span class="op">(</span><span class="st">"tests/testthat/test-plumber.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run tests matching a pattern</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_file.html" class="external-link">test_file</a></span><span class="op">(</span><span class="st">"tests/testthat/test-plumber.R"</span>, filter <span class="op">=</span> <span class="st">"routing"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-example-apis">Running Example APIs<a class="anchor" aria-label="anchor" href="#running-example-apis"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run an example API from inst/plumber/</span></span>
<span><span class="fu"><a href="reference/pr.html">pr</a></span><span class="op">(</span><span class="st">"inst/plumber/10-welcome/plumber.R"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/pr_run.html">pr_run</a></span><span class="op">(</span>port <span class="op">=</span> <span class="fl">8000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or for development testing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rplumber.io">plumber</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/pr.html">pr</a></span><span class="op">(</span><span class="st">"path/to/test-api.R"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/pr_run.html">pr_run</a></span><span class="op">(</span>port <span class="op">=</span> <span class="fl">8000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-via-command-line">Testing via Command Line<a class="anchor" aria-label="anchor" href="#testing-via-command-line"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Run full R CMD check</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">R</span> CMD build . <span class="kw">&amp;&amp;</span> <span class="ex">R</span> CMD check plumber_<span class="pp">*</span>.tar.gz</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Run tests only</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Run specific test file</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-plumber.R')"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="r6-class-hierarchy">R6 Class Hierarchy<a class="anchor" aria-label="anchor" href="#r6-class-hierarchy"></a></h3>
<p>The package uses R6 for object-oriented design with a clear inheritance chain:</p>
<pre><code>Hookable (base class - provides hook system)
  └── Plumber (main API router)
        ├── PlumberStatic (static file serving)
        └── PlumberStep (execution lifecycle base)
              ├── PlumberEndpoint (terminal request handlers)
              └── PlumberFilter (middleware)</code></pre>
<p><strong>Key files:</strong> - <a href="R/hookable.R">R/hookable.R</a> - Hook registration and execution (preroute, postroute, preserialize, etc.) - <a href="R/plumber.R">R/plumber.R</a> - Core <code>Plumber</code> class with routing engine - <a href="R/plumber-step.R">R/plumber-step.R</a> - <code>PlumberStep</code>, <code>PlumberEndpoint</code>, <code>PlumberFilter</code> classes</p>
</div>
<div class="section level3">
<h3 id="request-processing-pipeline">Request Processing Pipeline<a class="anchor" aria-label="anchor" href="#request-processing-pipeline"></a></h3>
<p>Understanding the request flow is critical for debugging and extending the framework:</p>
<ol style="list-style-type: decimal"><li>
<strong>Request arrives</strong> → <code>Plumber$call()</code> invoked (<a href="R/plumber.R#L565-L846">R/plumber.R:565-846</a>)</li>
<li>
<strong>Pre-route hooks</strong> execute (auth, logging, request modification)</li>
<li>
<strong>Route matching</strong> in priority order:
<ul><li>
<code>"__first__"</code> preempted endpoints (highest priority)</li>
<li>Filters execute sequentially with <code><a href="reference/forward.html">forward()</a></code> continuation</li>
<li>Endpoints checked at each preemption level</li>
<li>Mounted sub-routers (<code><a href="reference/pr_mount.html">pr_mount()</a></code>)</li>
<li>404 handler if no match</li>
</ul></li>
<li>
<strong>Post-route hooks</strong> execute (after handler, before serialization)</li>
<li>
<strong>Serialization</strong>:
<ul><li>Pre-serialize hooks (modify response object)</li>
<li>Serializer function application</li>
<li>Post-serialize hooks (modify final output)</li>
</ul></li>
<li>
<strong>HTTP response</strong> returned</li>
</ol><p><strong>Forward mechanism:</strong> Filters must call <code><a href="reference/forward.html">forward()</a></code> to pass control to the next handler. This uses an execution domain pattern tracked internally.</p>
</div>
<div class="section level3">
<h3 id="annotation-parsing-system">Annotation Parsing System<a class="anchor" aria-label="anchor" href="#annotation-parsing-system"></a></h3>
<p>APIs are defined using special comments that get parsed into route metadata:</p>
<p><strong>Core annotations:</strong> - <code>#* @get /path</code>, <code>#* @post /path</code> - HTTP verb + route - <code>#* @serializer json</code> - Output format (json, html, png, csv, etc.) - <code>#* @parser json</code> - Input parsing (json, form, multipart, etc.) - <code>#* @param name:type Description</code> - Parameter documentation - <code>#* @filter name</code> - Define filter/middleware - <code>#* @preempt [filter_name]</code> - Control execution order - <code>#* @plumber</code> - Router-level configuration</p>
<p><strong>Implementation:</strong> - <a href="R/plumb-block.R">R/plumb-block.R</a> - <code>plumbBlock()</code> scans backward from function to find <code>#*</code> comments - Uses regex to parse structured tags into metadata - <code>evaluateBlock()</code> creates <code>PlumberEndpoint</code> or <code>PlumberFilter</code> objects - Supports both <code>#*</code> (recommended) and <code>#'</code> prefixes</p>
</div>
<div class="section level3">
<h3 id="plugin-architecture">Plugin Architecture<a class="anchor" aria-label="anchor" href="#plugin-architecture"></a></h3>
<p>Three extensible registries in <code>.globals</code> environment:</p>
<ol style="list-style-type: decimal"><li>
<strong>Serializers</strong> (<a href="R/serializer.R">R/serializer.R</a>) - Transform R objects to HTTP responses
<ul><li>28+ built-in: json, html, png, csv, geojson, arrow, parquet, xlsx, etc.</li>
<li>Composable via <code><a href="reference/serializers.html">serializer_headers()</a></code> → <code><a href="reference/serializers.html">serializer_content_type()</a></code> → specific serializers</li>
<li>Register custom: <code>register_serializer("name", func, contentType)</code>
</li>
</ul></li>
<li>
<strong>Parsers</strong> (<a href="R/parse-body.R">R/parse-body.R</a>, <a href="R/parse-query.R">R/parse-query.R</a>) - Parse request bodies
<ul><li>Query string: <code>parseQS()</code> handles URL parameters with encoding</li>
<li>Body parsing: Content-Type detection, multipart form support</li>
<li>Register custom: <code>register_parser("name", func, contentType)</code>
</li>
</ul></li>
<li>
<strong>Docs</strong> (<a href="R/ui.R">R/ui.R</a>) - Visual API documentation providers
<ul><li>Built-in: swagger, rapidoc, redoc</li>
<li>Mounted at <code>/__docs__/</code> by default</li>
<li>OpenAPI spec at <code>/openapi.json</code>
</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="openapi-specification-generation">OpenAPI Specification Generation<a class="anchor" aria-label="anchor" href="#openapi-specification-generation"></a></h3>
<p>Automatic OpenAPI 3.0 spec generation from annotations:</p>
<ul><li>
<a href="R/openapi-spec.R">R/openapi-spec.R</a> - <code>$getApiSpec()</code> generates full spec</li>
<li>
<a href="R/openapi-types.R">R/openapi-types.R</a> - Type inference from R function signatures</li>
<li>Parameter metadata extracted from <code>@param</code> tags</li>
<li>Response types inferred from serializers</li>
<li>
<code><a href="reference/pr_set_api_spec.html">pr_set_api_spec()</a></code> for manual spec customization</li>
</ul></div>
<div class="section level3">
<h3 id="asyncpromise-support">Async/Promise Support<a class="anchor" aria-label="anchor" href="#asyncpromise-support"></a></h3>
<p>Built on the <code>promises</code> package for non-blocking execution:</p>
<ul><li>
<a href="R/async.R">R/async.R</a> - <code>runSteps()</code> and <code>runStepsUntil()</code> handle sync/async</li>
<li>Promise detection via <code>is.promising(result)</code>
</li>
<li>Recursive step execution for async handlers</li>
<li>Error handling with <code>%...!%</code> catch operator</li>
<li>Filters and endpoints can return promises</li>
</ul></div>
<div class="section level3">
<h3 id="path-parameter-extraction">Path Parameter Extraction<a class="anchor" aria-label="anchor" href="#path-parameter-extraction"></a></h3>
<p>Regex-based path matching with type conversion:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /users/&lt;id:int&gt;</span></span>
<span><span class="co">#* @get /files/&lt;name:string&gt;</span></span>
<span><span class="co">#* @get /data/&lt;vals:[int]&gt;     # Array of integers</span></span></code></pre></div>
<p>Supported types: <code>int</code>, <code>double</code>/<code>numeric</code>, <code>bool</code>/<code>logical</code>, <code>string</code>, arrays <code>[type]</code></p>
<p>Implementation in <a href="R/plumber.R">R/plumber.R</a> - path regex compilation and parameter extraction.</p>
</div>
</div>
<div class="section level2">
<h2 id="code-organization">Code Organization<a class="anchor" aria-label="anchor" href="#code-organization"></a></h2>
<div class="section level3">
<h3 id="file-loading-order-collate-in-description">File Loading Order (Collate in DESCRIPTION)<a class="anchor" aria-label="anchor" href="#file-loading-order-collate-in-description"></a></h3>
<p>R requires specific file load order due to dependencies. The <code>Collate</code> field enforces: 1. Base classes first: <code>async.R</code>, <code>hookable.R</code> 2. Core infrastructure: <code>plumber.R</code>, <code>plumber-step.R</code> 3. Features: parsers, serializers, OpenAPI 4. Utilities: <code>utils.R</code>, <code>zzz.R</code> (last - package hooks)</p>
<p>When adding new files, consider load order dependencies.</p>
</div>
<div class="section level3">
<h3 id="source-code-structure">Source Code Structure<a class="anchor" aria-label="anchor" href="#source-code-structure"></a></h3>
<p><strong>Core routing &amp; execution:</strong> - <a href="R/plumber.R">R/plumber.R</a> - Main <code>Plumber</code> class (845 lines) - <a href="R/plumber-step.R">R/plumber-step.R</a> - Step/Endpoint/Filter classes - <a href="R/hookable.R">R/hookable.R</a> - Hook system base class - <a href="R/async.R">R/async.R</a> - Promise/async execution engine</p>
<p><strong>API definition:</strong> - <a href="R/plumb.R">R/plumb.R</a> - <code><a href="reference/plumb.html">plumb()</a></code> entry point - <a href="R/plumb-block.R">R/plumb-block.R</a> - Annotation parser - <a href="R/pr.R">R/pr.R</a> - Programmatic API (<code><a href="reference/pr.html">pr()</a></code> constructor) - <a href="R/pr_set.R">R/pr_set.R</a> - Configuration methods (<code>pr_set_*()</code>)</p>
<p><strong>Data handling:</strong> - <a href="R/serializer.R">R/serializer.R</a> - Output serialization (28+ formats) - <a href="R/parse-body.R">R/parse-body.R</a> - Request body parsing - <a href="R/parse-query.R">R/parse-query.R</a> - Query string parsing</p>
<p><strong>OpenAPI/Documentation:</strong> - <a href="R/openapi-spec.R">R/openapi-spec.R</a> - OpenAPI 3.0 generation - <a href="R/openapi-types.R">R/openapi-types.R</a> - Type inference - <a href="R/ui.R">R/ui.R</a> - Swagger/Rapidoc/Redoc UI mounting</p>
<p><strong>Advanced features:</strong> - <a href="R/session-cookie.R">R/session-cookie.R</a> - Encrypted session cookies - <a href="R/plumber-static.R">R/plumber-static.R</a> - Static file serving - <a href="R/shared-secret-filter.R">R/shared-secret-filter.R</a> - Authentication - <a href="R/default-handlers.R">R/default-handlers.R</a> - 404/405/500 handlers</p>
</div>
</div>
<div class="section level2">
<h2 id="testing-strategy">Testing Strategy<a class="anchor" aria-label="anchor" href="#testing-strategy"></a></h2>
<div class="section level3">
<h3 id="test-organization">Test Organization<a class="anchor" aria-label="anchor" href="#test-organization"></a></h3>
<p>Tests in <a href="tests/testthat/">tests/testthat/</a> follow clear naming:</p>
<ul><li>
<strong>Unit tests:</strong> <code>test-&lt;feature&gt;.R</code> (e.g., <code>test-serializer.R</code>, <code>test-parser.R</code>)</li>
<li>
<strong>Integration tests:</strong> <code>test-&lt;component&gt;.R</code> (e.g., <code>test-plumber.R</code>, <code>test-endpoint.R</code>)</li>
<li>
<strong>Helper files:</strong> <code>helper-&lt;utility&gt;.R</code> (e.g., <code>helper-mock-request.R</code>)</li>
</ul></div>
<div class="section level3">
<h3 id="mock-request-helper">Mock Request Helper<a class="anchor" aria-label="anchor" href="#mock-request-helper"></a></h3>
<p>Use <code>make_req()</code> from <a href="tests/testthat/helper-mock-request.R">tests/testthat/helper-mock-request.R</a> to create test requests:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu">make_req</span><span class="op">(</span>verb <span class="op">=</span> <span class="st">"POST"</span>, path <span class="op">=</span> <span class="st">"/api/data"</span>, qs <span class="op">=</span> <span class="st">"param=value"</span>, body <span class="op">=</span> <span class="st">'{"key":"value"}'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-apis-for-testing">Example APIs for Testing<a class="anchor" aria-label="anchor" href="#example-apis-for-testing"></a></h3>
<p>17 complete example APIs in <a href="inst/plumber/">inst/plumber/</a> demonstrate all features: - <code>01-append</code> - Basic GET/POST - <code>02-filters</code> - Middleware patterns - <code>06-sessions</code> - Session management - <code>12-entrypoint</code> - Entrypoint pattern for complex APIs - <code>13-promises</code>, <code>14-future</code> - Async examples - <code>15-openapi-spec</code> - OpenAPI customization</p>
<p>Run examples with: <code>pr("inst/plumber/&lt;example&gt;/plumber.R") %&gt;% pr_run()</code></p>
</div>
</div>
<div class="section level2">
<h2 id="development-patterns">Development Patterns<a class="anchor" aria-label="anchor" href="#development-patterns"></a></h2>
<div class="section level3">
<h3 id="dual-api-design">Dual API Design<a class="anchor" aria-label="anchor" href="#dual-api-design"></a></h3>
<p>Plumber supports both annotation-based and programmatic API definition:</p>
<p><strong>Annotation-based (declarative):</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /hello</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">name</span> <span class="op">=</span> <span class="st">"world"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>message <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Hello"</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Programmatic (imperative):</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/pr.html">pr</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/pr_handle.html">pr_get</a></span><span class="op">(</span><span class="st">"/hello"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">name</span> <span class="op">=</span> <span class="st">"world"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>message <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Hello"</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Both approaches are first-class. Use annotations for file-based APIs, programmatic for dynamic construction.</p>
</div>
<div class="section level3">
<h3 id="router-composition-via-mounting">Router Composition via Mounting<a class="anchor" aria-label="anchor" href="#router-composition-via-mounting"></a></h3>
<p>Complex APIs can be composed from multiple routers:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">root</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pr.html">pr</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">users_api</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pr.html">pr</a></span><span class="op">(</span><span class="st">"apis/users.R"</span><span class="op">)</span></span>
<span><span class="va">products_api</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pr.html">pr</a></span><span class="op">(</span><span class="st">"apis/products.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">root</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/pr_mount.html">pr_mount</a></span><span class="op">(</span><span class="st">"/users"</span>, <span class="va">users_api</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/pr_mount.html">pr_mount</a></span><span class="op">(</span><span class="st">"/products"</span>, <span class="va">products_api</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/pr_run.html">pr_run</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Mounted routers maintain independent configurations (hooks, error handlers).</p>
</div>
<div class="section level3">
<h3 id="entrypoint-pattern">Entrypoint Pattern<a class="anchor" aria-label="anchor" href="#entrypoint-pattern"></a></h3>
<p>For APIs requiring initialization, use <code>entrypoint.R</code> that returns a configured router:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inst/plumber/12-entrypoint/entrypoint.R</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">port</span> <span class="op">=</span> <span class="fl">8000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="reference/pr.html">pr</a></span><span class="op">(</span><span class="st">"plumber.R"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="reference/pr_set_debug.html">pr_set_debug</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="reference/pr_cookie.html">pr_cookie</a></span><span class="op">(</span><span class="va">secret_key</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="reference/pr_hook.html">pr_hook</a></span><span class="op">(</span><span class="st">"preroute"</span>, <span class="va">logging_hook</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This pattern enables environment-specific configuration and dependency injection.</p>
</div>
</div>
<div class="section level2">
<h2 id="package-configuration">Package Configuration<a class="anchor" aria-label="anchor" href="#package-configuration"></a></h2>
<div class="section level3">
<h3 id="global-options">Global Options<a class="anchor" aria-label="anchor" href="#global-options"></a></h3>
<p>Set via <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> or environment variables:</p>
<ul><li>
<code>plumber.port</code>, <code>plumber.host</code> - Default server binding</li>
<li>
<code>plumber.maxRequestSize</code> - Max body size (bytes)</li>
<li>
<code>plumber.docs</code> - Enable/disable documentation UI</li>
<li>
<code>plumber.docs.callback</code> - Custom docs provider</li>
<li>
<code>plumber.apiURL</code>, <code>plumber.apiPath</code> - OpenAPI spec URLs</li>
</ul><p>See <a href="R/options_plumber.R">R/options_plumber.R</a> for full list.</p>
</div>
<div class="section level3">
<h3 id="cicd-pipeline">CI/CD Pipeline<a class="anchor" aria-label="anchor" href="#cicd-pipeline"></a></h3>
<p>GitHub Actions workflow (<a href=".github/workflows/R-CMD-check.yaml">.github/workflows/R-CMD-check.yaml</a>): - Runs on push to main, PRs, and weekly (Monday 7am) - Three jobs: website build, routine checks, R CMD check - Uses rstudio/shiny-workflows templates</p>
</div>
</div>
<div class="section level2">
<h2 id="common-pitfalls">Common Pitfalls<a class="anchor" aria-label="anchor" href="#common-pitfalls"></a></h2>
<div class="section level3">
<h3 id="annotation-order-matters">Annotation Order Matters<a class="anchor" aria-label="anchor" href="#annotation-order-matters"></a></h3>
<p>Annotations are parsed top-to-bottom. Place route-modifying annotations before the HTTP verb:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @serializer json     # ✓ Correct order</span></span>
<span><span class="co">#* @get /data</span></span></code></pre></div>
<p>Not:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /data</span></span>
<span><span class="co">#* @serializer json     # ✗ Won't apply to this endpoint</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="forward-is-required-in-filters">Forward() is Required in Filters<a class="anchor" aria-label="anchor" href="#forward-is-required-in-filters"></a></h3>
<p>Filters MUST call <code><a href="reference/forward.html">forward()</a></code> to continue the pipeline:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @filter logger</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">req</span><span class="op">$</span><span class="va">PATH_INFO</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="reference/forward.html">forward</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Required! Without this, request stops here</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="path-parameters-need-type-hints">Path Parameters Need Type Hints<a class="anchor" aria-label="anchor" href="#path-parameters-need-type-hints"></a></h3>
<p>Extract path params with type conversion:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /users/&lt;id:int&gt;    # ✓ Type specified</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># id is already an integer</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Without type hint, all params are strings.</p>
</div>
<div class="section level3">
<h3 id="serializer-vs-parser-confusion">Serializer vs Parser Confusion<a class="anchor" aria-label="anchor" href="#serializer-vs-parser-confusion"></a></h3>
<ul><li>
<strong>Serializer</strong> - Converts R object → HTTP response (output)</li>
<li>
<strong>Parser</strong> - Converts HTTP request → R object (input)</li>
</ul><p>Use <code>@serializer</code> for response format, <code>@parser</code> for request body format.</p>
</div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h2>
<ul><li>
<strong>Website:</strong> <a href="https://www.rplumber.io" class="uri">https://www.rplumber.io</a>
</li>
<li>
<strong>Vignettes:</strong> <a href="vignettes/">vignettes/</a> - 11 comprehensive guides</li>
<li>
<strong>Man pages:</strong> <a href="man/">man/</a> - Generated from roxygen2 comments</li>
<li>
<strong>Cheat sheet:</strong> <a href="https://github.com/rstudio/cheatsheets/blob/main/plumber.pdf" class="external-link uri">https://github.com/rstudio/cheatsheets/blob/main/plumber.pdf</a>
</li>
</ul><p>When adding new features, update corresponding vignette and man page.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, <a href="https://trestletech.com/" class="external-link">Jeff Allen</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer></body></html>

