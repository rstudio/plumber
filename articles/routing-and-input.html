<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Routing &amp; Input • plumber</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Routing &amp; Input">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plumber</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/routing-and-input.html">Routing &amp; Input</a></li>
    <li><a class="dropdown-item" href="../articles/rendering-output.html">Rendering Output</a></li>
    <li><a class="dropdown-item" href="../articles/execution-model.html">Runtime</a></li>
    <li><a class="dropdown-item" href="../articles/security.html">Security</a></li>
    <li><a class="dropdown-item" href="../articles/hosting.html">Hosting</a></li>
    <li><a class="dropdown-item" href="../articles/programmatic-usage.html">Programmatic Usage</a></li>
    <li><a class="dropdown-item" href="../articles/annotations.html">Annotations reference</a></li>
    <li><a class="dropdown-item" href="../articles/tips-and-tricks.html">Tips &amp; Tricks</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration Guide</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://blog.rstudio.com/2021/03/29/plumber-v1-1-0/">Version 1.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/plumber/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Routing &amp; Input</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/plumber/blob/rc-v1.3.0/vignettes/routing-and-input.Rmd" class="external-link"><code>vignettes/routing-and-input.Rmd</code></a></small>
      <div class="d-none name"><code>routing-and-input.Rmd</code></div>
    </div>

    
    
<p><img src="files%2Fimages%2Fplumber_input.png" width="45%" style="float:right;"></p>
<p>Plumber’s first job is to execute R code in response to incoming HTTP
requests, so it’s important to understand how incoming HTTP requests get
translated into the execution of R functions.</p>
<p>An incoming HTTP request must be “routed” to one or more R functions.
Plumber has two distinct families of functions that it handles:
endpoints and filters.</p>
<p>Typically, when a request arrives to a Plumber router, Plumber begins
by passing that request through its filters. Once the request has been
processed by all the filters, the router will look for an endpoint that
can satisfy the incoming request. If it finds one, it will invoke the
endpoint and respond to the incoming request using the value the
endpoint returned. If no endpoint matches the request, then a
<code>404 Not Found</code> error will be returned (the behavior of which
can be controlled by the <a href="./programmatic-usage.html#customize-router"><code>set404Handler</code></a>
method).</p>
<div class="section level2">
<h2 id="endpoints">Endpoints<a class="anchor" aria-label="anchor" href="#endpoints"></a>
</h2>
<p>Endpoints are the terminal step in the process of serving a request.
An endpoint can simply be viewed as the logic that is ultimately
responsible for generating a response to a particular request. A request
will be checked against each available endpoint until it finds an
endpoint willing to serve it at which point it stops looking; i.e. a
request will not ever be processed by more than one endpoint. You create
an endpoint by annotating a function like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* Return "hello world"</span></span>
<span><span class="co">#* @get /hello</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="st">"hello world"</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This annotation specifies that this function is responsible for
generating the response to any <code>GET</code> request to
<code>/hello</code>. The value returned from the function will be used
as the response to the request (after being run through a serializer to
e.g. convert the response into JSON). In this case, a <code>GET</code>
response to <code>/hello</code> would return the content
<code>["hello world"]</code> with a <code>JSON</code>
<code>Content-Type</code>.</p>
<p>The annotations that generate an endpoint include:</p>
<ul>
<li><code>@get</code></li>
<li><code>@post</code></li>
<li><code>@put</code></li>
<li><code>@delete</code></li>
<li><code>@head</code></li>
</ul>
<p>These map to the HTTP methods that an API client might send along
with a request. By default when you open a page in a web browser, that
sends a <code>GET</code> request to the API. But you can use other API
clients (or even JavaScript inside of a web browser) to form HTTP
requests using the other methods listed here. There are conventions
around when each of these methods should be used which you can read more
about <a href="http://www.restapitutorial.com/introduction/httpmethods.html" class="external-link">here</a>.
Note that some of these conventions carry with them security
implications, so it’s a good idea to follow the recommended uses for
each method until you fully understand why you might deviate from
them.</p>
<p>Note that a single endpoint can support multiple verbs. The following
function would be used to service any incoming <code>GET</code>,
<code>POST</code>, or <code>PUT</code> request to
<code>/cars</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /cars</span></span>
<span><span class="co">#* @post /cars</span></span>
<span><span class="co">#* @put /cars</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filters">Filters<a class="anchor" aria-label="anchor" href="#filters"></a>
</h2>
<p>Plumber filters can be used to define a “pipeline” for handling
incoming requests. This allows API authors to break down complex logic
into a sequence of independent, understandable steps. Unlike endpoints,
a request may go through multiple Plumber filters before a response is
generated.</p>
<p>Typically, a Plumber router will pass a request through all the
defined filters before it attempts to find an endpoint to satisfy the
request. However, endpoints can “preempt” particular filters if they
want to be considered for execution before some filter(s) registered in
the router.</p>
<p>Filters can do one of three things in handling a request:</p>
<ol style="list-style-type: decimal">
<li>Forward control onto the next handler, potentially after mutating
the request.</li>
<li>Return a response itself and not forward to subsequent handlers</li>
<li>Throw an error</li>
</ol>
<p>These three options, and why each might be desired, are discussed
below.</p>
<div class="section level3">
<h3 id="forward-to-another-handler">Forward to Another Handler<a class="anchor" aria-label="anchor" href="#forward-to-another-handler"></a>
</h3>
<p>The most common behavior for a filter is to pass on the request to
the next handler after mutating the incoming request or invoking some
external side-effect. One common use case is to use a filter as a
request logger:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* Log some information about the incoming request</span></span>
<span><span class="co">#* @filter logger</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="st">"-"</span>,</span>
<span>    <span class="va">req</span><span class="op">$</span><span class="va">REQUEST_METHOD</span>, <span class="va">req</span><span class="op">$</span><span class="va">PATH_INFO</span>, <span class="st">"-"</span>,</span>
<span>    <span class="va">req</span><span class="op">$</span><span class="va">HTTP_USER_AGENT</span>, <span class="st">"@"</span>, <span class="va">req</span><span class="op">$</span><span class="va">REMOTE_ADDR</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu">plumber</span><span class="fu">::</span><span class="fu"><a href="../reference/forward.html">forward</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This filter is straightforward: it invokes an external action
(logging) and then calls <code><a href="../reference/forward.html">forward()</a></code> to pass control to the
next handler in the pipeline (another filter or an endpoint).</p>
<p>Because the <code>req</code> and <code>res</code> parameters in
Plumber are based on R environments, they exhibit “pass-by-reference”
behavior. This means that changes that are made in one filter on the
<code>req</code> or <code>res</code> object will be visible to other
filters or endpoints also touching this same request or response.</p>
<p>A similar filter may mutate some state on the request or response
object it’s given.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @filter setuser</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">un</span> <span class="op">&lt;-</span> <span class="va">req</span><span class="op">$</span><span class="va">cookies</span><span class="op">$</span><span class="va">user</span></span>
<span>  <span class="co"># Make req$username available to endpoints</span></span>
<span>  <span class="va">req</span><span class="op">$</span><span class="va">username</span> <span class="op">&lt;-</span> <span class="va">un</span></span>
<span></span>
<span>  <span class="fu">plumber</span><span class="fu">::</span><span class="fu"><a href="../reference/forward.html">forward</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this case, the <code>req</code> object is going to be extended to
have an additional property named <code>username</code> which represents
a value looked up from a cookie. This <code>req$username</code> property
would be available to all subsequent filters and endpoints processing
this request. (Note that this example is not a secure system for
authentication; see the <a href="./execution-model.html#state-cookies">section on using cookies to
store state</a> for a longer discussion on why.) Once it has modified
the request object, it passes control to the next handler using
<code><a href="../reference/forward.html">forward()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="return-a-response">Return a Response<a class="anchor" aria-label="anchor" href="#return-a-response"></a>
</h3>
<p>It is also possible for filters to return a response. You may want to
check that the request satisfies some constraint (like authentication)
and – in certain cases – return a response without invoking any
additional handlers. For example, a filter could be used to check that a
user has authenticated.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @filter checkAuth</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">req</span><span class="op">$</span><span class="va">username</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">401</span> <span class="co"># Unauthorized</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error<span class="op">=</span><span class="st">"Authentication required"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">plumber</span><span class="fu">::</span><span class="fu"><a href="../reference/forward.html">forward</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A common cause of errors in Plumber APIs is forgetting to invoke
<code><a href="../reference/forward.html">forward()</a></code> in your filters. In such a filter, the result of
the last line will be silently returned as the response to the incoming
request. This can cause your API to exhibit very odd behavior depending
on what’s being returned. When you’re using filters, be sure to
carefully audit all code paths to ensure that you’re either calling
<code><a href="../reference/forward.html">forward()</a></code>, causing an error, or intentionally returning a
value.</p>
</div>
<div class="section level3">
<h3 id="throw-an-error">Throw an Error<a class="anchor" aria-label="anchor" href="#throw-an-error"></a>
</h3>
<p>Finally, a filter can throw an error. This can occur if a mistake is
made in the code defining the filter or if the filter intentionally
invokes <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> to trigger an error. In this case, the
request will not be processed by any subsequent handlers and will
immediately be sent to the router’s error handler. See <a href="./programmatic-usage.html#customize-router">router
customization</a> for more details on how to customize this error
handler.</p>
</div>
</div>
<div class="section level2">
<h2 id="dynamic-routes">Dynamic Routes<a class="anchor" aria-label="anchor" href="#dynamic-routes"></a>
</h2>
<p>In addition to having hard-coded routes like <code>/hello</code>,
Plumber endpoints can have dynamic routes. Dynamic routes allow
endpoints to define a more flexible set of paths against which they
should match.</p>
<p>A common REST convention is to include the identifier of an object in
the API paths associated with it. So to lookup information about user
#13, you might make a <code>GET</code> request to the path
<code>/users/13</code>. Rather than having to register routes for every
user your API might possibly encounter, you can use a dynamic route to
associate an endpoint with a variety of paths.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">users</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  uid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>,<span class="fl">13</span><span class="op">)</span>,</span>
<span>  username<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kim"</span>, <span class="st">"john"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#* Lookup a user</span></span>
<span><span class="co">#* @get /users/&lt;id&gt;</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">users</span>, <span class="va">uid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This API uses the dynamic path <code>/users/&lt;id&gt;</code> to
match any request that is of the form <code>/users/</code> followed by
some path element like a number or letters. In this case, it will return
information about the user if a user with the associated ID was found,
or an empty object if not.</p>
<p>You can name these dynamic path elements however you’d like, but note
that the name used in the dynamic path must match the name of the
parameter for the function (in this case, both <code>id</code>).</p>
<p>You can even do more complex dynamic routes like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /user/&lt;from&gt;/connect/&lt;to&gt;</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Do something with the `from` and `to` variables...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In both the hard-coded and dynamic examples given above, the
parameters will be provided to the function as a character string.</p>
</div>
<div class="section level2">
<h2 id="typed-dynamic-routes">Typed Dynamic Routes<a class="anchor" aria-label="anchor" href="#typed-dynamic-routes"></a>
</h2>
<p>Unless otherwise instructed, all parameters passed into plumber
endpoints from query strings or dynamic paths will be character strings.
For example, consider the following API.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /type/&lt;id&gt;</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="va">id</span>,</span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Visiting <a href="http://localhost:8000/types/14" class="external-link uri">http://localhost:8000/types/14</a> will return:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="dt">"id"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"14"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"character"</span><span class="ot">]</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>If you only intend to support a particular data type for a particular
parameter in your dynamic route, you can specify the desired type in the
route itself.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /user/&lt;id:int&gt;</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">next</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="co"># ...</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#* @post /user/activated/&lt;active:bool&gt;</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">active</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">active</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># ...</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Specifying the type of a dynamic path element will also narrow the
paths that will match the endpoint. For instance, the path
<code>/users/123</code> will match the first endpoint, but
<code>/users/8e3k</code> will not, since <code>8e3k</code> is not an
integer.</p>
<p>The following details the mapping of the type names that you can use
in your dynamic types and how they map to R data types.</p>
<table class="table">
<thead><tr class="header">
<th>R Type</th>
<th>Plumber Name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>logical</td>
<td>
<code>bool</code>, <code>logical</code>
</td>
</tr>
<tr class="even">
<td>numeric</td>
<td>
<code>double</code>, <code>numeric</code>
</td>
</tr>
<tr class="odd">
<td>integer</td>
<td><code>int</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="static-file-handler">Static File Handler<a class="anchor" aria-label="anchor" href="#static-file-handler"></a>
</h2>
<p>Plumber includes a static file server which can be used to host
directories of static assets such as JavaScript, CSS, or HTML files.
These servers are fairly simple to configure and integrate into your
plumber application.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @assets ./files/static</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This example would expose the local directory
<code>./files/static</code> at the default <code>/public</code> path on
your server. So if you had a file
<code>./files/static/branding.html</code>, it would be available on your
Plumber server at <code>/public/branding.html</code>.</p>
<p>You can optionally provide an additional argument to configure the
public path used for your server. For instance</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @assets ./files/static /static</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>would expose the local directory <code>files/static</code> not at
<code>/public</code>, but at <code>/static</code>. Likewise, to serve a
main <code>index.html</code>, you can also map
<code>/files/static</code> to <code>/</code> by using</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @assets ./files/static /</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>That enables you to serve your <code>/files/static/index.html</code>
under the <a href="http://localhost:8000/" class="external-link uri">http://localhost:8000/</a> root URL.</p>
<p>The “implementation” of your server in the above examples is just an
empty <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>. You can also specify a
<code>function()</code> like you do with the other plumber annotations.
At this point, the implementation doesn’t alter the behavior of your
static server. Eventually, this list or function may provide an
opportunity to configure the server by changing things like cache
control settings.</p>
<p>If you’re configuring a Plumber router programmatically, you can
instantiate a special static file router and mount it onto another
router as discussed in the <a href="./programmatic-usage.html#mount-static">static file router
section</a>.</p>
</div>
<div class="section level2">
<h2 id="input-handling">Input Handling<a class="anchor" aria-label="anchor" href="#input-handling"></a>
</h2>
<p>Plumber routes requests based exclusively on the path and method of
the incoming HTTP request, but requests can contain much more
information than just this. They might include additional HTTP headers,
a query string, or a request body. All of these fields may be viewed as
“inputs” to your Plumber API.</p>
<div class="section level3">
<h3 id="the-request-object">The Request Object<a class="anchor" aria-label="anchor" href="#the-request-object"></a>
</h3>
<p>HTTP requests in Plumber are stored as environments and satisfy the
<a href="https://github.com/jeffreyhorner/Rook/blob/a5e45f751/README.md#the-environment" class="external-link">Rook
interface</a>. The expected objects for all HTTP requests are the
following.</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="20%">
<col width="67%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Example</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>pr</code></td>
<td><code><a href="../reference/pr.html">plumber::pr()</a></code></td>
<td>The Plumber router that is processing the request</td>
</tr>
<tr class="even">
<td><code>cookies</code></td>
<td><code>list(cook = "abc")</code></td>
<td>A list of the cookies as described in <a href="#read-cookies">Cookies</a>
</td>
</tr>
<tr class="odd">
<td><code>httpuv.version</code></td>
<td><code>"1.3.3"</code></td>
<td>The version of the underlying <a href="https://github.com/rstudio/httpuv" class="external-link"><code>httpuv</code>
package</a>
</td>
</tr>
<tr class="even">
<td><code>PATH_INFO</code></td>
<td><code>"/"</code></td>
<td>The path of the incoming HTTP request</td>
</tr>
<tr class="odd">
<td><code>bodyRaw</code></td>
<td><code>charToRaw("a=1&amp;b=2")</code></td>
<td>The <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code>, unparsed contents of the body of the
request</td>
</tr>
<tr class="even">
<td><code>body</code></td>
<td><code>list(a = 1, b = 2)</code></td>
<td>This value will typically be the same as <code>argsBody</code>.
However, with content type <code>"multipart/*"</code>,
<code>req$body</code> may contain detailed information, such as
<code>name</code>, <code>content_type</code>,
<code>content_disposition</code>, <code>filename</code>,
<code>value</code> (which is a <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> vector), and
<code>parsed</code> (parsed version of <code>value</code>).</td>
</tr>
<tr class="odd">
<td><code>argsBody</code></td>
<td><code>list(a = 1, b = 2)</code></td>
<td>The parsed body output. Typically this is the same as
<code>req$body</code> except when type is
<code>"multipart/*"</code>.</td>
</tr>
<tr class="even">
<td><code>argsPath</code></td>
<td><code>list(c = 3, d = 4)</code></td>
<td>The values of the path arguments.</td>
</tr>
<tr class="odd">
<td><code>argsQuery</code></td>
<td><code>list(e = 5, f = 6)</code></td>
<td>The parsed query string output.</td>
</tr>
<tr class="even">
<td><code>args</code></td>
<td><code>list(req = req, res = res, e = 5, f = 6, c = 3, d = 4, a = 1, b = 2)</code></td>
<td>In a route, the combined arguments of
<code>list(req = req, res = res)</code>, <code>req$args</code> (added by
filters), <code>req$argsQuery</code>, <code>req$argsPath</code>, and
<code>req$argsBody</code>. In a filter, <code>req$args</code> is
initialized to an empty list, so when processing filters
<code>req$args</code> will only contain arguments set by previously
processed filters as the route information will not have been processed
yet.</td>
</tr>
<tr class="odd">
<td><code>QUERY_STRING</code></td>
<td><code>"?a=123&amp;b=abc"</code></td>
<td>The query-string portion of the HTTP request</td>
</tr>
<tr class="even">
<td><code>REMOTE_ADDR</code></td>
<td><code>"1.2.3.4"</code></td>
<td>The IP address of the client making the request</td>
</tr>
<tr class="odd">
<td><code>REMOTE_PORT</code></td>
<td><code>"62108"</code></td>
<td>The client port from which the request originated</td>
</tr>
<tr class="even">
<td><code>REQUEST_METHOD</code></td>
<td><code>"GET"</code></td>
<td>The method used for this HTTP request</td>
</tr>
<tr class="odd">
<td><code>rook.errors</code></td>
<td>N/A</td>
<td>See <a href="https://github.com/jeffreyhorner/Rook/blob/a5e45f751/README.md#the-input-stream" class="external-link">Rook
docs</a>
</td>
</tr>
<tr class="even">
<td><code>rook.input</code></td>
<td>N/A</td>
<td>See <a href="https://github.com/jeffreyhorner/Rook/blob/a5e45f751/README.md#the-error-stream" class="external-link">Rook
docs</a>
</td>
</tr>
<tr class="odd">
<td><code>rook.url_scheme</code></td>
<td><code>"http"</code></td>
<td>The “scheme” (typically <code>http</code> or
<code>https</code>)</td>
</tr>
<tr class="even">
<td><code>rook.version</code></td>
<td><code>"1.1-0"</code></td>
<td>The version of the rook specification which this environment
satisfies</td>
</tr>
<tr class="odd">
<td><code>SCRIPT_NAME</code></td>
<td><code>""</code></td>
<td>Unused</td>
</tr>
<tr class="even">
<td><code>SERVER_NAME</code></td>
<td><code>"127.0.0.1"</code></td>
<td>The host portion of the incoming request. You may favor
<code>HTTP_HOST</code>, if available.</td>
</tr>
<tr class="odd">
<td><code>SERVER_PORT</code></td>
<td><code>"8000"</code></td>
<td>The target port for the request</td>
</tr>
<tr class="even">
<td><code>HTTP_*</code></td>
<td><code>"HTTP_USER_AGENT"</code></td>
<td>Entries for all of the HTTP headers sent with this request</td>
</tr>
<tr class="odd">
<td><code>postBody</code></td>
<td><code>"a=1&amp;b=2"</code></td>
<td>The text contents of the body of the request. Despite the name, it
is available for any HTTP method. It is recommended to disable this
parsing, see <code><a href="../reference/options_plumber.html">?options_plumber</a></code>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="query-strings">Query Strings<a class="anchor" aria-label="anchor" href="#query-strings"></a>
</h3>
<p>A query string may be appended to a URL in order to convey additional
information beyond just the request route. Query strings allow for the
encoding of character string keys and values. For example, in the URL
<code>https://duckduckgo.com/?q=bread&amp;pretty=1</code>, everything
following the <code>?</code> constitutes the query string. In this case,
two variables (<code>q</code> and <code>pretty</code>) have been set (to
<code>bread</code> and <code>1</code>, respectively).</p>
<p>Plumber will automatically forward information from the query string
into the function being executed by aligning the name of the query
string with the name of the function parameter. The following example
defines a search API that mimics the example from <a href="https://duckduckgo.com" class="external-link">DuckDuckGo</a> above but merely prints out
what it receives.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /</span></span>
<span><span class="va">search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">=</span><span class="st">""</span>, <span class="va">pretty</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"The q parameter is '"</span>, <span class="va">q</span>, <span class="st">"'. "</span>,</span>
<span>         <span class="st">"The pretty parameter is '"</span>, <span class="va">pretty</span>, <span class="st">"'."</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Visiting <a href="http://localhost:8000/?q=bread&amp;pretty=1" class="external-link uri">http://localhost:8000/?q=bread&amp;pretty=1</a> will
print:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ot">[</span><span class="st">"The q parameter is 'bread'. The pretty parameter is '1'."</span><span class="ot">]</span></span></code></pre></div>
<p>This is equivalent to calling
<code>search(q="bread", pretty="1")</code>. If a parameter were not
specified in the query string, it would just be omitted from the
invocation of the endpoint. For example <a href="http://localhost:8000/?q=cereal" class="external-link uri">http://localhost:8000/?q=cereal</a> would be equivalent to
<code>search(q="cereal")</code>. The function would fall back to the
default value of the <code>pretty</code> parameter (<code>0</code>),
since that was defined in the function signature.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ot">[</span><span class="st">"The q parameter is 'cereal'. The pretty parameter is '0'."</span><span class="ot">]</span></span></code></pre></div>
<p>Including additional query string arguments that do not map to a
parameter of the function has no effect. For instance <a href="http://localhost:8000/?test=123" class="external-link uri">http://localhost:8000/?test=123</a> will return the same
results as calling <code><a href="https://rdrr.io/r/base/search.html" class="external-link">search()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ot">[</span><span class="st">"The q parameter is ''. The pretty parameter is '0'."</span><span class="ot">]</span></span></code></pre></div>
<p>(Note that the raw query string is available as
<code>req$QUERY_STRING</code>.)</p>
<p>Some web browsers impose limitations on the length of a URL. Internet
Explorer, in particular, caps the query string at 2,048 characters. If
you need to send large amounts of data from a client to your API, it
would likely be a better idea to send it in a <a href="#request-body">request body</a>.</p>
</div>
<div class="section level3">
<h3 id="request-body">Request Body<a class="anchor" aria-label="anchor" href="#request-body"></a>
</h3>
<p>Another way to provide additional information inside an HTTP request
is using the message body. Effectively, once a client specifies all the
metadata about a request (the path it’s trying to reach, some HTTP
headers, etc.) it can then provide a message body. The maximum size of a
request body depends largely on the technologies involved (client,
proxies, etc.) but is typically at least 2MB – much larger than a query
string. This approach is most commonly seen with <code>PUT</code> and
<code>POST</code> requests, though you could encounter it with other
HTTP methods.</p>
<p>Plumber will attempt to parse the request body in one using allowed
<a href="https://www.rplumber.io/reference/parsers.html">parsers</a>.
Any fields provided in the message body will be passed through as
parameters to the function.</p>
<div class="section level4">
<h4 id="files-handling-note">Files handling note<a class="anchor" aria-label="anchor" href="#files-handling-note"></a>
</h4>
<p>When dealing with binary parameters, Plumber will return a named list
of raw vector. The names in the list are the original uploaded
filenames. Raw values are binary content of each file.</p>
<p>Unfortunately, crafting a request with a message body requires a bit
more work than making a <code>GET</code> request with a query string
from your web browser, but you can use tools like <code>curl</code> on
the command line or the <a href="https://httr2.r-lib.org" class="external-link">httr2 R
package</a>. We’ll use <code>curl</code> for the examples below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @post /user</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">id</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="va">id</span>,</span>
<span>    name <span class="op">=</span> <span class="va">name</span>,</span>
<span>    body <span class="op">=</span> <span class="va">req</span><span class="op">$</span><span class="va">body</span>,</span>
<span>    raw <span class="op">=</span> <span class="va">req</span><span class="op">$</span><span class="va">bodyRaw</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Running
<code>curl --data "id=123&amp;name=Jennifer" "http://localhost:8000/user"</code>
will return:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="dt">"id"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">123</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"Jennifer"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="dt">"body"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>    <span class="dt">"id"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">123</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"Jennifer"</span><span class="ot">]</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="dt">"raw"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"aWQ9MTIzJm5hbWU9SmVubmlmZXI="</span><span class="ot">]</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Alternatively,
<code>echo {"id":123, "name": "Jennifer"} &gt; call.json &amp; curl --data @call.json "http://localhost:8000/user" -H "content-type: application/json"</code>
(formatting the body as JSON) will have the same effect.</p>
<p>As demonstrated above, the raw request body is made available as
<code>req$bodyRaw</code> and parsed request body is available as
<code>req$body</code>.</p>
</div>
<div class="section level4">
<h4 id="named-parameters-collision-note">Named parameters collision note<a class="anchor" aria-label="anchor" href="#named-parameters-collision-note"></a>
</h4>
<p>Only the first matched formal arguments are passed automatically to
the endpoint during execution. Duplicates are dropped. Query parameters
have priority over path parameters, then finally, body parameters are
matched last.</p>
<p>While not required, it is recommended that endpoints have a function
definition that only accepts the formals <code>req</code>,
<code>res</code>, and <code>...</code> to avoid duplicates. If the
endpoint arguments are to be processed like a list, they are available
at <code>req$argsBody</code>, with all arguments at
<code>req$args</code>. <code>req$args</code> is a combination of
<code>list(req = req, res = res)</code>, <code>req$argsPath</code>,
<code>req$argsBody</code>, and <code>req$argsQuery</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="cf">function</span>(req[, res, ...]) {</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  ...</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  req<span class="sc">$</span>argsQuery</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  req<span class="sc">$</span>argsPath</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  req<span class="sc">$</span>argsBody</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  ...</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="read-cookies">Cookies<a class="anchor" aria-label="anchor" href="#read-cookies"></a>
</h3>
<p>If cookies are attached to the incoming request, they’ll be made
available via <code>req$cookies</code>. This will contain a list of all
the cookies that were included with the request. The names of the list
correspond to the names of the cookies and the value for each element
will be a character string. See the <a href="./rendering-output.html#setting-cookies">Setting Cookies
section</a> for details on how to set cookies from Plumber.</p>
<p>If you’ve set encrypted cookies (as discussed in the <a href="./rendering-output.html#encrypted-cookies">Encrypted Cookies
section</a>), that session will be decrypted and made available at
<code>req$session</code>.</p>
</div>
<div class="section level3">
<h3 id="headers">Headers<a class="anchor" aria-label="anchor" href="#headers"></a>
</h3>
<p>HTTP headers attached to the incoming request are attached to the
request object. They are prefixed with <code>HTTP_</code>, the name of
the header is capitalized, and hyphens are substituted for underscores.
e.g. the <code>Content-Type</code> HTTP header can be found as
<code>req$HTTP_CONTENT_TYPE</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* Return the value of a custom header</span></span>
<span><span class="co">#* @get /</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    val <span class="op">=</span> <span class="va">req</span><span class="op">$</span><span class="va">HTTP_CUSTOMHEADER</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Running
<code>curl --header "customheader: abc123" http://localhost:8000</code>
will return:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="dt">"val"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"abc123"</span><span class="ot">]</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>You can print out the names of all of the properties attached to the
request by running <code>print(ls(req))</code> inside an endpoint.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, <a href="https://trestletech.com/" class="external-link">Jeff Allen</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
